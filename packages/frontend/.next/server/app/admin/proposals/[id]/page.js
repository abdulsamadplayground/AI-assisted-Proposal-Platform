(()=>{var e={};e.id=338,e.ids=[338],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9556:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>o.a,__next_app__:()=>x,originalPathname:()=>p,pages:()=>d,routeModule:()=>m,tree:()=>c}),t(7201),t(9457),t(2029),t(5866);var r=t(3191),a=t(8716),n=t(7922),o=t.n(n),l=t(5231),i={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>l[e]);t.d(s,i);let c=["",{children:["admin",{children:["proposals",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,7201)),"C:\\Users\\ABDUL SAMAD\\Desktop\\AI assisted document platform\\packages\\frontend\\src\\app\\admin\\proposals\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,9457)),"C:\\Users\\ABDUL SAMAD\\Desktop\\AI assisted document platform\\packages\\frontend\\src\\app\\admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,2029)),"C:\\Users\\ABDUL SAMAD\\Desktop\\AI assisted document platform\\packages\\frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\ABDUL SAMAD\\Desktop\\AI assisted document platform\\packages\\frontend\\src\\app\\admin\\proposals\\[id]\\page.tsx"],p="/admin/proposals/[id]/page",x={require:t,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/proposals/[id]/page",pathname:"/admin/proposals/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},1258:(e,s,t)=>{Promise.resolve().then(t.bind(t,9548))},9548:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i});var r=t(326),a=t(8069),n=t(7577),o=t(5047),l=t(8426);function i(){let e=(0,o.useParams)(),s=(0,o.useRouter)(),t=e.id,[i,c]=(0,n.useState)(null),[d,p]=(0,n.useState)(!0),[x,m]=(0,n.useState)(null),[h,u]=(0,n.useState)(!1),[g,y]=(0,n.useState)({}),[b,f]=(0,n.useState)(!1),[j,v]=(0,n.useState)(""),[w,N]=(0,n.useState)(null),[C,k]=(0,n.useState)(!1),[_,E]=(0,n.useState)([]),[P,D]=(0,n.useState)(!1),[S,A]=(0,n.useState)(null),[T,R]=(0,n.useState)(!1),U=async()=>{try{p(!0),m(null);let e=await fetch(`${a.T5}/api/proposals/${t}`,{headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to fetch proposal");let s=await e.json();c(s)}catch(s){let e=s instanceof Error?s.message:"Failed to load proposal";m(e),l.C.error(e)}finally{p(!1)}},L=(e,s)=>{y({...g,[e]:s})},$=async()=>{if(i)try{let e=i.sections?.map(e=>({...e,content:g[e.id]||e.content}));if(!(await fetch(`${a.T5}/api/proposals/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sections:e,status:"under_review"})})).ok)throw Error("Failed to save changes");u(!1),y({}),l.C.success('Changes saved! Proposal status updated to "Under Review"'),U()}catch(s){let e=s instanceof Error?s.message:"Failed to save changes";l.C.error(e)}},F=async e=>{N(e);let s=l.C.loading("Regenerating section with Rule + LLM engine...");try{if(!(await fetch(`${a.T5}/api/proposals/${t}/regenerate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({section_type:e})})).ok)throw Error("Failed to regenerate section");l.C.dismiss(s),l.C.success("Section regenerated successfully!"),U()}catch(t){l.C.dismiss(s);let e=t instanceof Error?t.message:"Failed to regenerate section";l.C.error(e)}finally{N(null)}},M=async()=>{if(!window.confirm("Are you sure you want to regenerate all sections? This will replace all current content."))return;N("all");let e=l.C.loading("Regenerating all sections with Rule + LLM engine...");try{if(!(await fetch(`${a.T5}/api/proposals/${t}/regenerate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({section_type:"all"})})).ok)throw Error("Failed to regenerate proposal");l.C.dismiss(e),l.C.success("All sections regenerated successfully!"),U()}catch(t){l.C.dismiss(e);let s=t instanceof Error?t.message:"Failed to regenerate proposal";l.C.error(s)}finally{N(null)}},O=async()=>{if(window.confirm("Are you sure you want to accept this proposal?"))try{if(!(await fetch(`${a.T5}/api/proposals/${t}/approve`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw Error("Failed to approve proposal");l.C.success("Proposal accepted! User will be notified."),setTimeout(()=>s.push("/admin/proposals"),1500)}catch(s){let e=s instanceof Error?s.message:"Failed to approve proposal";l.C.error(e)}},B=async()=>{if(!j.trim()){l.C.error("Please provide comments for rejection");return}try{if(!(await fetch(`${a.T5}/api/proposals/${t}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comments:j})})).ok)throw Error("Failed to reject proposal");l.C.success("Proposal rejected! User will be notified with your comments."),f(!1),setTimeout(()=>s.push("/admin/proposals"),1500)}catch(s){let e=s instanceof Error?s.message:"Failed to reject proposal";l.C.error(e)}},q=async()=>{D(!0);try{let e=await fetch(`${a.T5}/api/proposals/${t}/versions`,{headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to fetch version history");let s=await e.json();E(s),k(!0)}catch(s){let e=s instanceof Error?s.message:"Failed to load version history";l.C.error(e)}finally{D(!1)}},V=async()=>{R(!0);let e=l.C.loading("Exporting to Word document...");try{let s=await fetch(`${a.T5}/api/proposals/${t}/export`,{headers:{"Content-Type":"application/json"}});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to export proposal")}let r=await s.blob(),n=window.URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download=`${i?.title.replace(/[^a-z0-9]/gi,"_")}.docx`,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o),l.C.dismiss(e),l.C.success("Proposal exported successfully!")}catch(t){l.C.dismiss(e);let s=t instanceof Error?t.message:"Failed to export proposal";l.C.error(s)}finally{R(!1)}};return d?r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Loading proposal..."})]})}):x||!i?r.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"text-6xl mb-4",children:"⚠️"}),r.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Proposal"}),r.jsx("p",{className:"text-gray-600 mb-6",children:x||"Proposal not found"}),r.jsx("button",{onClick:U,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors mr-4",children:"Try Again"}),r.jsx("button",{onClick:()=>s.push("/admin/proposals"),className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"Back to Proposals"})]})}):(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:r.jsx("div",{className:"flex items-start justify-between",children:(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:i.title}),(e=>{let s=e.toLowerCase();return r.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${{awaiting_approval:"bg-yellow-100 text-yellow-800",pending_approval:"bg-yellow-100 text-yellow-800",under_review:"bg-blue-100 text-blue-800",rejected:"bg-red-100 text-red-800",accepted:"bg-green-100 text-green-800",approved:"bg-green-100 text-green-800"}[s]||"bg-gray-100 text-gray-800"}`,children:{awaiting_approval:"Awaiting Approval",pending_approval:"Pending Approval",under_review:"Under Review",rejected:"Rejected",accepted:"Accepted",approved:"Approved"}[s]||e})})(i.status)]}),(0,r.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-500",children:"User:"}),r.jsx("span",{className:"ml-2 font-medium",children:i.user_name||"Unknown"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Schema:"}),r.jsx("span",{className:"ml-2 font-medium",children:i.schema_name||"No schema"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Submitted:"}),r.jsx("span",{className:"ml-2 font-medium",children:new Date(i.created_at).toLocaleString()})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Proposal ID:"}),r.jsx("span",{className:"ml-2 font-medium",children:i.id})]})]})]})})}),r.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("button",{onClick:()=>u(!h),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:h?"✏️ Editing Mode":"✏️ Edit Proposal"}),r.jsx("button",{onClick:M,disabled:null!==w,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:"all"===w?"⏳ Regenerating...":"\uD83D\uDD04 Regenerate All Sections"}),h&&r.jsx("button",{onClick:$,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"\uD83D\uDCBE Save Changes"}),r.jsx("button",{onClick:q,disabled:P,className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors disabled:opacity-50",children:P?"⏳ Loading...":"\uD83D\uDCDC View Versions"}),"approved"===i.status&&r.jsx("button",{onClick:V,disabled:T,className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50",children:T?"⏳ Exporting...":"\uD83D\uDCC4 Export to Word"}),r.jsx("div",{className:"flex-1"}),r.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"❌ Reject"}),r.jsx("button",{onClick:O,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"✅ Accept"})]})}),i.survey_notes&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Original Survey Notes"}),r.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:r.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:i.survey_notes})})]}),i.sections&&i.sections.length>0&&(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Proposal Sections"}),i.sections.map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),e.ruleEnforcement&&(0,r.jsxs)("div",{className:"mt-2 flex items-center space-x-2",children:[e.ruleEnforcement.passed?r.jsx("span",{className:"text-xs px-2 py-1 bg-green-100 text-green-800 rounded",children:"✓ All Rules Passed"}):(0,r.jsxs)("span",{className:"text-xs px-2 py-1 bg-red-100 text-red-800 rounded",children:["✗ Rule Violations: ",e.ruleEnforcement.violations.length]}),e.ruleEnforcement.warnings.length>0&&(0,r.jsxs)("span",{className:"text-xs px-2 py-1 bg-yellow-100 text-yellow-800 rounded",children:["⚠ ",e.ruleEnforcement.warnings.length," Warnings"]})]}),e.ruleEnforcement&&e.ruleEnforcement.warnings.length>0&&r.jsx("div",{className:"mt-2 text-xs text-yellow-700",children:e.ruleEnforcement.warnings.map((e,s)=>(0,r.jsxs)("div",{children:["• ",e]},s))})]}),r.jsx("button",{onClick:()=>F(e.id),disabled:null!==w,className:"px-3 py-1 text-sm bg-purple-100 text-purple-700 rounded hover:bg-purple-200 transition-colors disabled:opacity-50",children:w===e.id?"⏳ Regenerating...":"\uD83D\uDD04 Regenerate"})]}),h?r.jsx("textarea",{value:void 0!==g[e.id]?g[e.id]:e.content,onChange:s=>L(e.id,s.target.value),className:"w-full h-40 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Edit section content..."}):r.jsx("div",{className:"prose max-w-none",children:r.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:e.content})})]},e.id))]}),b&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-md w-full",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Reject Proposal"}),r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Please provide comments explaining why this proposal is being rejected. The user will receive these comments."}),r.jsx("textarea",{value:j,onChange:e=>v(e.target.value),className:"w-full h-32 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Enter rejection comments..."}),(0,r.jsxs)("div",{className:"mt-4 flex justify-end space-x-3",children:[r.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Cancel"}),r.jsx("button",{onClick:B,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Reject Proposal"})]})]})}),C&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Version History"}),r.jsx("button",{onClick:()=>{k(!1),A(null)},className:"text-gray-400 hover:text-gray-600 text-2xl",children:"\xd7"})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:S?(0,r.jsxs)("div",{children:[r.jsx("button",{onClick:()=>A(null),className:"mb-4 text-blue-600 hover:text-blue-800 flex items-center",children:"← Back to version list"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h4",{className:"text-xl font-semibold text-gray-900",children:["Version ",S.version_number]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:S.change_description}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Modified by ",S.created_by_name," on"," ",new Date(S.created_at).toLocaleString()]})]}),r.jsx("div",{className:"space-y-4",children:S.sections.map(e=>(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[r.jsx("h5",{className:"font-semibold text-gray-900 mb-2",children:e.name}),r.jsx("p",{className:"text-gray-700 whitespace-pre-wrap text-sm",children:e.content})]},e.id))})]}):r.jsx("div",{className:"space-y-3",children:_.map(e=>r.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>A(e),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("span",{className:"font-semibold text-gray-900",children:["Version ",e.version_number]}),(0,r.jsxs)("span",{className:"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded",children:[e.sections.length," sections"]})]}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.change_description}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Modified by ",e.created_by_name," on"," ",new Date(e.created_at).toLocaleString()]})]}),r.jsx("button",{className:"text-blue-600 hover:text-blue-800 text-sm",children:"View →"})]})},e.id))})})]})})]})}},7201:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`C:\Users\ABDUL SAMAD\Desktop\AI assisted document platform\packages\frontend\src\app\admin\proposals\[id]\page.tsx#default`)}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[630,910,194],()=>t(9556));module.exports=r})();